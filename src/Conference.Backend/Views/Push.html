<!DOCTYPE html>
<html>
<head>
    <title>Conference Push Notifications</title>
    <meta charset="utf-8" />
</head>
<body>
    <div>
        <h2>Send Push Notifications</h2>
        <br />
        <p>Here you can send push notifications out. Select which platforms you want to send to and input a message.</p>
    </div>

    <div>
        <h3>Password</h3>
        You must enter this:<br />
        <textarea name="password" id="password" cols="40" rows="1" size="256"></textarea>
        <br />
        <h3>Notification</h3>
        <br /> <br />
        <textarea name="message" id="message" cols="40" rows="5" size="256"></textarea>
        <br />
        
        <input type="button" value="Send Notification" onclick="sendNotification(this)" />
        <p id="status" />

        <br />
        <br />

        <h3>Announcements</h3>
        This are synced in the app and show up in feed.<br />
        <textarea name="announcement" id="announcement" cols="40" rows="5" size="256"></textarea>
        <br />

        <input type="button" value="Send Announcement" onclick="sendAnnouncement(this)" />
        <p id="status2" />
    </div>
    <script>
        function sendAnnouncement(button) {

            var status = document.getElementById("status2");
            var message = document.getElementById("announcement");
            var password = document.getElementById("password");
            status.innerHTML = "Sending announcement : ";
            button.disabled = true;

           
                var http = new XMLHttpRequest();
                http.open("POST", "/api/announcement?password=" + password.value, true);

                http.onreadystatechange = function () {
                    if (http.readyState == 4) {
                        if (http.status == 200) {
                            status.innerHTML += "\n Sent " + http.responseText;
                        }
                        else {
                            status.innerHTML += "\n Error " + http.statusText;
                        }
                    }
                }

                var toSendA = JSON.stringify(message.value);
                http.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                http.setRequestHeader("Content-length", toSendA.length);
                http.setRequestHeader("Connection", "close");
                http.setRequestHeader("ZUMO-API-VERSION", "2.0.0");
                http.send(toSendA);

                button.disabled = false;
            }

        function sendNotification(button) {

            var status = document.getElementById("status");
            var message = document.getElementById("message");
            var password = document.getElementById("password");
            status.innerHTML = "Sending notification : ";
            button.disabled = true;

            var http = new XMLHttpRequest();
                http.open("POST", "/api/conferencenotifications?pns=apns&password="+password.value, true);

                http.onreadystatechange = function () {
                    if (http.readyState == 4) {
                        if (http.status == 200) {
                            status.innerHTML += "\n Notification: Sent " + http.responseText;
                        }
                        else {
                            status.innerHTML += "\n Notification: Error " + http.statusText;
                        }
                    }
                }

                var toSendA = JSON.stringify(message.value);
                http.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                http.setRequestHeader("Content-length", toSendA.length);
                http.setRequestHeader("Connection", "close");
                http.setRequestHeader("ZUMO-API-VERSION", "2.0.0");
                http.send(toSendA);

            button.disabled = false;
        }
    </script>

</body>
</html>
